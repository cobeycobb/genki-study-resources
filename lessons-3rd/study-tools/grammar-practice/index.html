<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#" class="lang-en">
  <head>
    <meta charset="UTF-8">
    <title>Grammar Practice Hub - Study Tools | Genki Study Resources - 3rd Edition</title>
    <meta name="title" content="Grammar Practice Hub - Study Tools | Genki Study Resources - 3rd Edition">
    <meta name="twitter:title" content="Grammar Practice Hub - Study Tools | Genki Study Resources - 3rd Edition">
    <meta property="og:title" content="Grammar Practice Hub - Study Tools | Genki Study Resources - 3rd Edition">
    <meta name="description" content="Browse and practice grammar patterns from all Genki lessons with custom quiz generation.">
    <meta property="og:description" content="Browse and practice grammar patterns from all Genki lessons with custom quiz generation.">
    <link rel="shortcut icon" type="image/x-icon" href="../../../resources/images/genkico.ico">

    <meta name="keywords" content="Genki, japanese, grammar, practice, quizzes, exercises, 3rd Edition" lang="en">
    <meta name="language" content="en">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:site_name" content="sethclydesdale.github.io">
    <meta property="og:url" content="https://sethclydesdale.github.io/genki-study-resources/lessons-3rd/study-tools/grammar-practice/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sethclydesdale.github.io/genki-study-resources/resources/images/genki-thumb.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@SethC1995">

    <link rel="stylesheet" href="../../../resources/css/stylesheet.min.css">
    <script src="../../../resources/javascript/head.min.js"></script>
    <script src="../../../resources/javascript/ga.js" async></script>

    <style>
      /* Custom styles for grammar practice hub */
      .grammar-hub-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .tab-container {
        margin: 20px 0;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #ddd;
      }

      .tab-button {
        padding: 10px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
      }

      .tab-button:hover {
        background: #f0f0f0;
      }

      .tab-button.active {
        border-bottom-color: #4a90e2;
        font-weight: bold;
      }

      .tab-content {
        display: none;
        padding: 20px 0;
      }

      .tab-content.active {
        display: block;
      }

      /* Grammar Browser Styles */
      .filter-controls {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .filter-row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 10px;
      }

      .filter-group {
        flex: 1;
        min-width: 200px;
      }

      .filter-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .filter-group input,
      .filter-group select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .grammar-list {
        display: grid;
        gap: 15px;
      }

      .grammar-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        transition: all 0.3s;
      }

      .grammar-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transform: translateY(-2px);
      }

      .grammar-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .grammar-title {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        flex: 1;
      }

      .grammar-lesson {
        background: #4a90e2;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        margin-right: 10px;
      }

      .grammar-page {
        color: #666;
        font-size: 14px;
      }

      .grammar-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .grammar-card .button {
        flex: 1;
        text-align: center;
        padding: 8px 16px;
        font-size: 14px;
      }

      .stats-badge {
        background: #e8f4f8;
        color: #2c5aa0;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 12px;
        margin-left: 10px;
      }

      .stats-badge.completed {
        background: #d4edda;
        color: #155724;
      }

      /* Quiz Builder Styles */
      .quiz-builder {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
      }

      .lesson-selector {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin: 20px 0;
      }

      .lesson-checkbox {
        background: white;
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .lesson-checkbox:hover {
        border-color: #4a90e2;
      }

      .lesson-checkbox input[type="checkbox"] {
        margin-right: 8px;
      }

      .lesson-checkbox.selected {
        background: #e8f4f8;
        border-color: #4a90e2;
      }

      .quiz-summary {
        background: white;
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }

      .quiz-summary h3 {
        margin-top: 0;
        color: #4a90e2;
      }

      .selected-exercises-list {
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
      }

      .selected-exercise-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        border-bottom: 1px solid #eee;
      }

      .selected-exercise-item:hover {
        background: #f9f9f9;
      }

      .remove-exercise {
        background: #dc3545;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .no-results {
        text-align: center;
        padding: 40px;
        color: #999;
        font-size: 18px;
      }

      .stats-container {
        display: flex;
        gap: 20px;
        margin: 20px 0;
      }

      .stat-card {
        flex: 1;
        background: white;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        border: 1px solid #ddd;
      }

      .stat-number {
        font-size: 32px;
        font-weight: bold;
        color: #4a90e2;
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      .checkbox-label {
        cursor: pointer;
        user-select: none;
      }
    </style>
  </head>

  <body>

    <header>
      <h1><a href="../../" id="home-link" class="edition-icon third-ed">Genki Study Resources</a></h1>
      <a id="fork-me" href="https://github.com/SethClydesdale/genki-study-resources">Fork Me</a>
    </header>

    <div id="announcement">
      <div id="announce-inner">
        <h3><i class="fa">&#xf0a1;</i> News and Info</h3>
        <div id="announce-list">
          <div id="announcement-controls" style="display:none;">
            <button class="button announce-controls button-left" onclick="GenkiAnn.next(-1, true);"><i class="fa">&#xf060;</i></button>
            <button class="button announce-controls button-right" onclick="GenkiAnn.next(+1, true);"><i class="fa">&#xf061;</i></button>
          </div>
          <noscript><div class="announcement">Please enable JavaScript to get the latest news and info.</div></noscript>
        </div>
      </div>
    </div>

    <div id="content">
      <div class="content-block grammar-hub-container">
        <h2 class="title center">Grammar Practice Hub</h2>

        <p class="center">
          Browse all grammar exercises from Genki 3rd Edition, track your progress, and create custom practice quizzes.
        </p>

        <div class="tab-container">
          <div class="tabs">
            <button class="tab-button active" onclick="switchTab('browser')">
              <i class="fa">&#xf03a;</i> Grammar Browser
            </button>
            <button class="tab-button" onclick="switchTab('quiz')">
              <i class="fa">&#xf044;</i> Custom Quiz Builder
            </button>
          </div>

          <!-- Grammar Browser Tab -->
          <div id="browser-tab" class="tab-content active">
            <div class="stats-container" id="stats-container">
              <div class="stat-card">
                <div class="stat-number" id="total-exercises">0</div>
                <div class="stat-label">Total Grammar Exercises</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="completed-exercises">0</div>
                <div class="stat-label">Completed</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="completion-percentage">0%</div>
                <div class="stat-label">Completion Rate</div>
              </div>
            </div>

            <div class="filter-controls">
              <h3>Filter Exercises</h3>
              <div class="filter-row">
                <div class="filter-group">
                  <label for="search-input"><i class="fa">&#xf002;</i> Search</label>
                  <input type="text" id="search-input" placeholder="Search for grammar pattern..." oninput="filterGrammarList()">
                </div>

                <div class="filter-group">
                  <label for="lesson-filter"><i class="fa">&#xf02d;</i> Lesson</label>
                  <select id="lesson-filter" onchange="filterGrammarList()">
                    <option value="">All Lessons</option>
                  </select>
                </div>

                <div class="filter-group">
                  <label for="status-filter"><i class="fa">&#xf0b0;</i> Status</label>
                  <select id="status-filter" onchange="filterGrammarList()">
                    <option value="">All</option>
                    <option value="completed">Completed</option>
                    <option value="not-completed">Not Completed</option>
                  </select>
                </div>
              </div>

              <div class="filter-row">
                <button class="button" onclick="resetFilters()">
                  <i class="fa">&#xf021;</i> Reset Filters
                </button>
                <button class="button" onclick="clearProgress()">
                  <i class="fa">&#xf1f8;</i> Clear Progress Data
                </button>
              </div>
            </div>

            <div id="grammar-list" class="grammar-list">
              <!-- Grammar cards will be inserted here -->
            </div>

            <div id="no-results" class="no-results" style="display: none;">
              <i class="fa" style="font-size: 48px;">&#xf119;</i>
              <p>No exercises match your filters.</p>
            </div>
          </div>

          <!-- Custom Quiz Builder Tab -->
          <div id="quiz-tab" class="tab-content">
            <div class="quiz-builder">
              <h3>Select Lessons</h3>
              <p>Choose which lessons to include in your custom grammar quiz:</p>

              <div class="lesson-selector" id="lesson-selector">
                <!-- Lesson checkboxes will be inserted here -->
              </div>

              <div class="quiz-summary" id="quiz-summary" style="display: none;">
                <h3><i class="fa">&#xf0ae;</i> Selected Exercises (<span id="selected-count">0</span>)</h3>
                <div class="selected-exercises-list" id="selected-exercises-list">
                  <!-- Selected exercises will be listed here -->
                </div>
                <div class="center">
                  <button class="button" onclick="startCustomQuiz()" style="font-size: 18px; padding: 12px 24px;">
                    <i class="fa">&#xf04b;</i> Start Custom Quiz
                  </button>
                  <button class="button" onclick="clearSelection()" style="margin-left: 10px;">
                    <i class="fa">&#xf00d;</i> Clear Selection
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer class="clear">
      <ul class="footer-left">
        <li><a href="../../" id="footer-home">Home</a></li>
        <li><a href="../../../privacy/">Privacy</a></li>
        <li><a href="../../../report/">Report a Bug</a></li>
        <li><a href="../../../help/">Help</a></li>
        <li><a href="../../../donate/">Donate</a></li>
      </ul>

      <ul class="footer-right">
        <li>Created by <a href="https://github.com/SethClydesdale">Seth Clydesdale</a> and the <a href="https://github.com/SethClydesdale/genki-study-resources/graphs/contributors">GitHub Community</a></li>
      </ul>
    </footer>

    <script src="../../../resources/javascript/dragula.min.js"></script>
    <script src="../../../resources/javascript/easytimer.min.js"></script>
    <script src="../../../resources/javascript/exercises/3rd-ed.min.js"></script>
    <script src="../../../resources/javascript/genki.min.js"></script>
    <script src="../../../resources/javascript/all.min.js"></script>

    <script>
      // Grammar Practice Hub JavaScript

      // Parse grammar exercises from the GenkiExercises array
      let grammarExercises = [];
      let selectedExercises = new Set();
      let progressData = {};

      // Load progress data from localStorage
      function loadProgress() {
        const saved = localStorage.getItem('genki-grammar-progress');
        if (saved) {
          try {
            progressData = JSON.parse(saved);
          } catch (e) {
            progressData = {};
          }
        }
      }

      // Save progress data to localStorage
      function saveProgress() {
        localStorage.setItem('genki-grammar-progress', JSON.stringify(progressData));
        updateStats();
      }

      // Mark exercise as completed
      function markCompleted(exerciseId) {
        if (!progressData[exerciseId]) {
          progressData[exerciseId] = {
            completed: 0,
            lastAttempt: null,
            bestScore: 0
          };
        }
        progressData[exerciseId].completed++;
        progressData[exerciseId].lastAttempt = new Date().toISOString();
        saveProgress();
        renderGrammarList();
      }

      // Clear all progress
      function clearProgress() {
        if (confirm('Are you sure you want to clear all progress data? This cannot be undone.')) {
          progressData = {};
          localStorage.removeItem('genki-grammar-progress');
          updateStats();
          renderGrammarList();
        }
      }

      // Parse exercises on page load
      function parseExercises() {
        if (typeof window.GenkiExercises === 'undefined') {
          console.error('GenkiExercises not loaded');
          return;
        }

        grammarExercises = window.GenkiExercises
          .map((exercise, index) => {
            const parts = exercise.split('|');
            const path = parts[0];
            const title = parts[1];
            const page = parts[2];

            // Extract lesson number and type
            const pathParts = path.split('/');
            const lessonMatch = pathParts[0].match(/lesson-(\d+)/);
            const lessonNum = lessonMatch ? parseInt(lessonMatch[1]) : 0;
            const exerciseType = pathParts[1];

            return {
              id: index,
              path: path,
              title: title,
              page: page,
              lesson: lessonNum,
              type: exerciseType,
              url: `../../${path}/`
            };
          })
          .filter(ex => ex.type && ex.type.startsWith('grammar-'));

        console.log(`Loaded ${grammarExercises.length} grammar exercises`);
      }

      // Update statistics
      function updateStats() {
        const total = grammarExercises.length;
        const completed = Object.keys(progressData).length;
        const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;

        document.getElementById('total-exercises').textContent = total;
        document.getElementById('completed-exercises').textContent = completed;
        document.getElementById('completion-percentage').textContent = percentage + '%';
      }

      // Render grammar list
      function renderGrammarList() {
        const container = document.getElementById('grammar-list');
        const noResults = document.getElementById('no-results');

        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const lessonFilter = document.getElementById('lesson-filter').value;
        const statusFilter = document.getElementById('status-filter').value;

        let filtered = grammarExercises.filter(ex => {
          // Search filter
          if (searchTerm && !ex.title.toLowerCase().includes(searchTerm)) {
            return false;
          }

          // Lesson filter
          if (lessonFilter && ex.lesson.toString() !== lessonFilter) {
            return false;
          }

          // Status filter
          if (statusFilter === 'completed' && !progressData[ex.id]) {
            return false;
          }
          if (statusFilter === 'not-completed' && progressData[ex.id]) {
            return false;
          }

          return true;
        });

        if (filtered.length === 0) {
          container.style.display = 'none';
          noResults.style.display = 'block';
          return;
        }

        container.style.display = 'grid';
        noResults.style.display = 'none';

        container.innerHTML = filtered.map(ex => {
          const progress = progressData[ex.id];
          const isCompleted = progress && progress.completed > 0;
          const completedText = isCompleted ? `âœ“ Completed ${progress.completed}x` : 'Not attempted';

          return `
            <div class="grammar-card">
              <div class="grammar-card-header">
                <div style="flex: 1;">
                  <span class="grammar-lesson">Lesson ${ex.lesson}</span>
                  <span class="grammar-title">${ex.title}</span>
                  <span class="stats-badge ${isCompleted ? 'completed' : ''}">${completedText}</span>
                </div>
                <span class="grammar-page">${ex.page}</span>
              </div>
              <div class="grammar-actions">
                <a href="${ex.url}" class="button" onclick="markCompleted(${ex.id})">
                  <i class="fa">&#xf04b;</i> Practice
                </a>
                <button class="button" onclick="addToQuiz(${ex.id})">
                  <i class="fa">&#xf067;</i> Add to Quiz
                </button>
              </div>
            </div>
          `;
        }).join('');
      }

      // Filter grammar list
      function filterGrammarList() {
        renderGrammarList();
      }

      // Reset filters
      function resetFilters() {
        document.getElementById('search-input').value = '';
        document.getElementById('lesson-filter').value = '';
        document.getElementById('status-filter').value = '';
        renderGrammarList();
      }

      // Populate lesson filter dropdown
      function populateLessonFilter() {
        const lessons = [...new Set(grammarExercises.map(ex => ex.lesson))].sort((a, b) => a - b);
        const select = document.getElementById('lesson-filter');

        lessons.forEach(lesson => {
          const option = document.createElement('option');
          option.value = lesson;
          option.textContent = `Lesson ${lesson}`;
          select.appendChild(option);
        });
      }

      // Populate lesson selector for quiz builder
      function populateLessonSelector() {
        const lessons = [...new Set(grammarExercises.map(ex => ex.lesson))].sort((a, b) => a - b);
        const container = document.getElementById('lesson-selector');

        container.innerHTML = lessons.map(lesson => {
          const exerciseCount = grammarExercises.filter(ex => ex.lesson === lesson).length;
          return `
            <label class="lesson-checkbox checkbox-label" id="lesson-checkbox-${lesson}">
              <input type="checkbox" value="${lesson}" onchange="toggleLesson(${lesson})">
              Lesson ${lesson} (${exerciseCount} exercises)
            </label>
          `;
        }).join('');
      }

      // Toggle lesson selection
      function toggleLesson(lesson) {
        const checkbox = event.target;
        const label = document.getElementById(`lesson-checkbox-${lesson}`);

        if (checkbox.checked) {
          label.classList.add('selected');
          grammarExercises.filter(ex => ex.lesson === lesson).forEach(ex => {
            selectedExercises.add(ex.id);
          });
        } else {
          label.classList.remove('selected');
          grammarExercises.filter(ex => ex.lesson === lesson).forEach(ex => {
            selectedExercises.delete(ex.id);
          });
        }

        updateQuizSummary();
      }

      // Add individual exercise to quiz
      function addToQuiz(exerciseId) {
        selectedExercises.add(exerciseId);
        updateQuizSummary();

        // Switch to quiz builder tab
        switchTab('quiz');

        // Show feedback
        const exercise = grammarExercises.find(ex => ex.id === exerciseId);
        if (exercise) {
          alert(`Added "${exercise.title}" to your custom quiz!`);
        }
      }

      // Update quiz summary
      function updateQuizSummary() {
        const summary = document.getElementById('quiz-summary');
        const count = document.getElementById('selected-count');
        const list = document.getElementById('selected-exercises-list');

        count.textContent = selectedExercises.size;

        if (selectedExercises.size === 0) {
          summary.style.display = 'none';
          return;
        }

        summary.style.display = 'block';

        const selectedArray = Array.from(selectedExercises).map(id =>
          grammarExercises.find(ex => ex.id === id)
        ).filter(ex => ex !== undefined);

        list.innerHTML = selectedArray.map(ex => `
          <div class="selected-exercise-item">
            <div>
              <span class="grammar-lesson">L${ex.lesson}</span>
              <strong>${ex.title}</strong> <span style="color: #666;">${ex.page}</span>
            </div>
            <button class="remove-exercise" onclick="removeFromQuiz(${ex.id})">
              <i class="fa">&#xf00d;</i> Remove
            </button>
          </div>
        `).join('');
      }

      // Remove exercise from quiz
      function removeFromQuiz(exerciseId) {
        selectedExercises.delete(exerciseId);

        // Uncheck lesson checkbox if all exercises from that lesson are removed
        const exercise = grammarExercises.find(ex => ex.id === exerciseId);
        if (exercise) {
          const lessonExercises = grammarExercises.filter(ex => ex.lesson === exercise.lesson);
          const hasSelected = lessonExercises.some(ex => selectedExercises.has(ex.id));

          if (!hasSelected) {
            const checkbox = document.querySelector(`#lesson-selector input[value="${exercise.lesson}"]`);
            if (checkbox) {
              checkbox.checked = false;
              document.getElementById(`lesson-checkbox-${exercise.lesson}`).classList.remove('selected');
            }
          }
        }

        updateQuizSummary();
      }

      // Clear selection
      function clearSelection() {
        selectedExercises.clear();

        // Uncheck all lesson checkboxes
        document.querySelectorAll('#lesson-selector input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
        });
        document.querySelectorAll('.lesson-checkbox').forEach(label => {
          label.classList.remove('selected');
        });

        updateQuizSummary();
      }

      // Start custom quiz
      function startCustomQuiz() {
        if (selectedExercises.size === 0) {
          alert('Please select at least one exercise to practice.');
          return;
        }

        // Open exercises in new tabs
        const selectedArray = Array.from(selectedExercises).map(id =>
          grammarExercises.find(ex => ex.id === id)
        ).filter(ex => ex !== undefined);

        const confirmMsg = `This will open ${selectedArray.length} exercise${selectedArray.length > 1 ? 's' : ''} in new tabs. Continue?`;

        if (!confirm(confirmMsg)) {
          return;
        }

        selectedArray.forEach((ex, index) => {
          setTimeout(() => {
            window.open(ex.url, '_blank');
            markCompleted(ex.id);
          }, index * 100); // Stagger opening to avoid popup blocker
        });
      }

      // Switch tabs
      function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab-button').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // Update tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
      }

      // Initialize on page load
      window.addEventListener('load', () => {
        loadProgress();
        parseExercises();
        populateLessonFilter();
        populateLessonSelector();
        renderGrammarList();
        updateStats();
      });
    </script>
  </body>
</html>
